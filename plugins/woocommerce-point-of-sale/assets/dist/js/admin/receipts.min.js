"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,i=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,o)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}!function(s,t){var r={admin:wc_pos_params,receipts:wc_pos_admin_receipts_params},c={id:"#wc-pos-receipt-form",watchFields:['[name="name"]','[name="show_title"]','[name="title_position"]','[name="width"]','[name="logo"]','[name="logo_position"]','[name="logo_size"]','[name="outlet_details_position"]','[name="show_shop_name"]','[name="show_outlet_name"]','[name="show_outlet_address"]','[name="show_outlet_contact_details"]','[name="social_details_position"]','[name="show_social_twitter"]','[name="show_social_facebook"]','[name="show_social_instagram"]','[name="show_social_snapchat"]','[name="show_wifi_details"]','[name="show_tax_number"]','[name="tax_number_label"]','[name="tax_number_position"]','[name="show_order_status"]','[name="show_order_date"]','[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]','[name="show_customer_name"]','[name="show_customer_email"]','[name="show_customer_phone"]','[name="show_customer_shipping_address"]','[name="show_customer_billing_address"]','[name="show_cashier_name"]','[name="cashier_name_format"]','[name="product_details_layout"]','[name="show_register_name"]','[name="show_product_image"]','[name="show_product_sku"]','[name="show_product_cost"]','[name="show_product_discount"]','[name="show_original_price"]','[name="show_num_items"]','[name="show_tax_summary"]','[name="show_order_barcode"]','[name="barcode_type"]','[name="header_text"]','[name="footer_text"]','[name="text_size"]','[name="print_copies"]'],cachedDateFormats:{},cachedTimeFormats:{},logoUploader:null,init:function(){s(this.id).on("submit",this.submitted).on("change keyup","input, select, textarea",this.changed).on("change keyup",this.watchFields.join(","),this.updatePreview).on("change keyup",this.watchFields.join(","),this.updateOptions).on("click","#customize-control-logo button.upload",this.selectLogo).on("click","#customize-control-logo button.remove",this.removeLogo).on("click","#customize-control-logo button.upload, #customize-control-logo button.remove",this.changed).find(this.watchFields.filter(function(e){return-1===['[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]'].indexOf(e)}).join(",")).trigger("change");var e=wp.codeEditor.initialize(s("#custom_css"),{codemirror:{lineNumbers:!0,mode:"css",indentUnit:4,indentWithTabs:!0}});this.updatePreviewCss(e.codemirror.doc.getValue()),e.codemirror.on("change",function(e){c.updatePreviewCss(e.doc.getValue()),s("#custom_css").val(e.doc.getValue())})},validate:function(e){var t,o={},i={};return e.forEach(function(e){o[e.name]=e.value}),void 0!==o.name&&0!==o.name.trim().length||(i.name_is_empty=r.receipts.i18n_field_name_empty),void 0===o.width||0===o.width.trim().length?i.width_is_empty=r.receipts.i18n_field_width_empty:Number(o.width)<0&&(i.width_is_negative=r.receipts.i18n_field_width_negative),!(0<Object.keys(i).length&&(t=s("#customize-notifications-area"),e=s(".wp-full-overlay-sidebar-content"),t.children("ul").html(""),Object.values(i).forEach(function(e){t.children("ul").append('\n\t\t\t\t\t\t<li class="notice notice-error" data-code="client_side_error" data-type="error">\n\t\t\t\t\t\t\t<div class="notification-message">'.concat(e,"</div>\n\t\t\t\t\t\t</li>"))}),i=t.outerHeight()+1,e.css("top",45+i+"px"),1))},submitted:function(e){e.preventDefault(),s("body").addClass("saving"),c.validate(s(this).serializeArray())?(e={receipt_id:r.receipts.receipt_id,action:"wc_pos_update_receipt",data:s(this).serializeArray().reduce(function(e,t){return _objectSpread(_objectSpread({},e),{},_defineProperty({},t.name,t.value))}),security:r.receipts.update_receipt_nonce},s.ajax({url:r.admin.ajax_url,data:e,type:"POST",success:function(e){s("body").removeClass("saving"),e.success?(s(c.id).find('input[type="submit"]').prop("disabled",!0),0===r.receipts.receipt_id.length&&(t.location.href=r.admin.admin_url+"post.php?post="+e.data.id+"&action=edit")):t.alert(e.data.error)}})):s("body").removeClass("saving")},changed:function(){s(c.id).find('input[type="submit"]').prop("disabled",!1)},updatePreview:function(e){var t,e=s(e.target),o=e.attr("name"),i=e.val();if("name"===o&&s(".name").html(i),"show_title"===o&&(s(e).is(":checked")?s(".title").show():s(".title").hide()),"title_position"===o&&s(".title").css("text-align",i),"width"===o&&(i=(i=parseInt(i))&&0<i&&i<=120?"".concat(i,"mm"):"100%",s("#receipt-preview").css("width",i)),"logo"===o&&(0===parseInt(i)||0===i.length?s(".logo").hide():s(".logo").show()),"logo_position"===o&&s(".logo").css("text-align",i),"logo_size"===o){var a="auto";switch(i){case"normal":a="6cm";break;case"small":a="2cm";break;case"large":a="100%"}s(".logo img").css("width",a)}if("outlet_details_position"===o&&(s(".outlet-details").css("text-align",i),s(".outlet-details-footer").css("text-align",i)),"show_shop_name"===o&&(s(e).is(":checked")?s(".shop-name").show():s(".shop-name").hide()),"show_outlet_name"===o&&(s(e).is(":checked")?s(".outlet-name").show():s(".outlet-name").hide()),"show_outlet_address"===o&&(s(e).is(":checked")?s(".outlet-address").show():s(".outlet-address").hide()),"show_outlet_contact_details"===o&&(s(e).is(":checked")?s(".outlet-contact-details").show():s(".outlet-contact-details").hide()),"social_details_position"===o&&(t=s(".social-details"),"header"===i?t.insertAfter(".wifi-details"):"footer"===i&&t.appendTo(".outlet-details-footer")),"show_social_twitter"===o&&(s(e).is(":checked")?s(".social-twitter").show():s(".social-twitter").hide()),"show_social_facebook"===o&&(s(e).is(":checked")?s(".social-facebook").show():s(".social-facebook").hide()),"show_social_instagram"===o&&(s(e).is(":checked")?s(".social-instagram").show():s(".social-instagram").hide()),"show_social_snapchat"===o&&(s(e).is(":checked")?s(".social-snapchat").show():s(".social-snapchat").hide()),"show_wifi_details"===o&&(s(e).is(":checked")?s(".wifi-details").show():s(".wifi-details").hide()),"show_tax_number"===o&&(s(e).is(":checked")?s(".tax-number").show():s(".tax-number").hide()),"tax_number_label"===o&&(0<i.length?s(".tax-number-label").html(i+":"):s(".tax-number-label").html("")),"tax_number_position"===o&&s(".tax-number").css("text-align",i),"show_order_status"===o&&(s(e).is(":checked")?s(".order-status").show():s(".order-status").hide()),"show_order_date"===o&&(s(e).is(":checked")?s(".order-date").show():s(".order-date").hide()),"order_date_format"===o||"order_date_format_custom"===o){if(i=""===s('[name="order_date_format"]:checked').val()?s('[name="order_date_format_custom"]').val():i,void 0!==c.cachedDateFormats[i])return void s(".order-date td .date").html(c.cachedDateFormats[i]);s.ajax({url:r.admin.ajax_url,data:{action:"wc_pos_date_i18n",security:r.receipts.date_i18n_nonce,data:{format:i,date:r.receipts.time}},type:"POST",success:function(e){e.success&&(s(".order-date td .date").html(e.data.date),c.cachedDateFormats[i]=e.data.date)}})}if("order_time_format"===o||"order_time_format_custom"===o){if(i=""===s('[name="order_time_format"]:checked').val()?s('[name="order_time_format_custom"]').val():i,void 0!==c.cachedTimeFormats[i])return void s(".order-date td .time").html(c.cachedTimeFormats[i]);s.ajax({url:r.admin.ajax_url,data:{action:"wc_pos_date_i18n",security:r.receipts.date_i18n_nonce,data:{format:i,date:r.receipts.date}},type:"POST",success:function(e){e.success&&(s(".order-date td .time").html(e.data.date),c.cachedTimeFormats[i]=e.data.date)}})}"show_customer_name"===o&&(s(e).is(":checked")?s(".customer-name").show():s(".customer-name").hide()),"show_customer_email"===o&&(s(e).is(":checked")?s(".customer-email").show():s(".customer-email").hide()),"show_customer_phone"===o&&(s(e).is(":checked")?s(".customer-phone").show():s(".customer-phone").hide()),"show_customer_shipping_address"===o&&(s(e).is(":checked")?s(".customer-shipping-address").show():s(".customer-shipping-address").hide()),"show_customer_billing_address"===o&&(s(e).is(":checked")?s(".customer-billing-address").show():s(".customer-billing-address").hide()),"show_cashier_name"===o&&(s(e).is(":checked")?s(".cashier-name").show():s(".cashier-name").hide()),"cashier_name_format"===o&&s(".cashier-name .cashier").html(s(".cashier-name").data(i)),"product_details_layout"===o&&("single"===i?(s(".product-details-layout-single").css("display","table-header-group"),s(".product-details-layout-multiple")):(s(".product-details-layout-multiple").css("display","table-header-group"),s(".product-details-layout-single"))).css("display","none"),"show_register_name"===o&&(s(e).is(":checked")?s(".register-name").show():s(".register-name").hide()),"show_product_image"===o&&(s(e).is(":checked")?(s("thead th.image").show(),s(".receipt-product-image").show()):(s("thead th.image").hide(),s(".receipt-product-image").hide())),"show_product_sku"===o&&(s(e).is(":checked")?s(".receipt-product-sku").show():s(".receipt-product-sku").hide()),"show_product_cost"===o&&(s(e).is(":checked")?(s("thead th.cost").show(),s(".receipt-product-cost").show()):(s("thead th.cost").hide(),s(".receipt-product-cost").hide())),"show_product_discount"===o&&(s(e).is(":checked")?(s("#receipt-preview .show-if-discount-enabled").show(),s("#receipt-preview .line-through-if-discount-enabled").css("text-decoration","line-through")):(s("#receipt-preview .show-if-discount-enabled").hide(),s("#receipt-preview .line-through-if-discount-enabled").css("text-decoration","none"))),"show_original_price"===o&&(s(e).is(":checked")?s("#receipt-preview .receipt-original-price").show():s("#receipt-preview .receipt-original-price").hide()),"show_num_items"===o&&(s(e).is(":checked")?s(".no-items").show():s(".no-items").hide()),"show_tax_summary"===o&&(s(e).is(":checked")?s(".tax-summary").show():s(".tax-summary").hide()),"show_order_barcode"===o&&(s(e).is(":checked")?s(".order-barcode").show():s(".order-barcode").hide()),"barcode_type"===o&&(t=document.createElement("canvas"),bwipjs.toCanvas(t,{bcid:i,text:"WC1234AE",scale:2,includetext:!0,textxalign:"center"}),s(".order-barcode img").attr("src",t.toDataURL("image/png"))),"header_text"===o&&s(".header-text").html(i),"footer_text"===o&&s(".footer-text").html(i),"text_size"===o&&s("#receipt-preview").removeClass("text-tiny text-small text-normal text-large").addClass("text-"+i)},updateOptions:function(e){var e=s(e.target),t=e.attr("name"),e=e.val();"print_copies"===t&&("num_copies"!==e?s("#control_num_copies").hide():s("#control_num_copies").show())},selectLogo:function(){if(!c.logoUploader)return c.logoUploader=wp.media.frames.logoUploader=wp.media({title:"Select a Receipt Logo ",button:{text:"Set Receipt Logo"},multiple:!1,library:{type:"image/png,image/jpeg"}}),c.logoUploader.on("select",function(){var e=c.logoUploader.state().get("selection").first().toJSON();s("#logo").val(e.id).trigger("change"),s("#customize-control-logo").addClass("selected"),s("#customize-control-logo .attachment-thumb").attr("src",e.url),s("#receipt-preview .logo img").attr("src",e.url)}),c.logoUploader.open(),!1;c.logoUploader.open()},removeLogo:function(){return s("#logo").val("").trigger("change"),s("#customize-control-logo").removeClass("selected"),s("#customize-control-logo .attachment-thumb").attr("src",""),s("#receipt-preview .logo img").attr("src",""),!1},updatePreviewCss:function(e){s(".custom-css").replaceWith('<style type="text/less" id="receipt-custom-css">#receipt-preview {'.concat(e,"}</style>")),t.less&&t.less.refresh(!0)}};c.init(),s(c.id).find("#save").prop("disabled",!1),s(".customize-pane-parent").on("click",".accordion-section-title",function(e){e.preventDefault();e=s(this).parent().attr("aria-owns"),e=s("#"+e);s(".wp-full-overlay-sidebar-content").addClass("section-open"),e.addClass("open")}),s(".customize-pane-child").on("click",".customize-section-back",function(e){s(this).parents(".customize-pane-child").removeClass("open"),s(".wp-full-overlay-sidebar-content").removeClass("section-open")})}(jQuery,window,document);